# Production compose example for docker-compose.production.yml
# Copy to .env.production and set real secrets/URLs before use.

# Container images
BROKER_ADMIN_API_IMAGE=ghcr.io/your-org/broker-admin-api:latest
BROKER_API_IMAGE=ghcr.io/your-org/broker-api:latest

# Public ports
BROKER_ADMIN_API_PORT=8080
BROKER_API_PORT=8081

# Shared infrastructure
BROKER_ADMIN_API_DATABASE_URL=postgresql://broker:${BROKER_DB_PASSWORD}@postgres.internal:5432/broker
BROKER_ADMIN_API_REDIS_URL=redis://:${BROKER_REDIS_PASSWORD}@redis.internal:6379
BROKER_API_DATABASE_URL=postgresql://broker:${BROKER_DB_PASSWORD}@postgres.internal:5432/broker
BROKER_API_REDIS_URL=redis://:${BROKER_REDIS_PASSWORD}@redis.internal:6379
# Optional CORS origins (comma-separated). Keep empty to disable CORS in production.
# BROKER_ADMIN_API_CORS_ALLOWED_ORIGINS=
# BROKER_API_CORS_ALLOWED_ORIGINS=

# broker-admin-api required security settings
BROKER_ADMIN_API_SECRET_KEY_B64=replace-with-32-byte-base64
BROKER_ADMIN_API_AUTH_MODE=oidc
BROKER_ADMIN_API_OIDC_ISSUER=https://idp.example.com
BROKER_ADMIN_API_OIDC_AUDIENCE=broker-admin-api
BROKER_ADMIN_API_OIDC_JWKS_URI=https://idp.example.com/.well-known/jwks.json

# Certificate issuance (vault mode)
BROKER_ADMIN_API_CERT_ISSUER_MODE=vault
BROKER_ADMIN_API_MTLS_CA_PEM=replace-with-ca-pem
BROKER_ADMIN_API_VAULT_ADDR=https://vault.example.com:8200
BROKER_ADMIN_API_VAULT_TOKEN=replace-with-vault-token
BROKER_ADMIN_API_VAULT_PKI_MOUNT=pki
BROKER_ADMIN_API_VAULT_PKI_ROLE=broker-workloads

# broker-api production requirements
BROKER_API_PUBLIC_BASE_URL=https://broker.example.com
# Directory mounted read-only into broker-api at /run/certs/broker-api
# Must include: server.key, server.crt, ca.crt, healthcheck-client.key, healthcheck-client.crt
BROKER_API_TLS_CERTS_DIR=/etc/broker-api/tls
BROKER_API_TLS_KEY_PATH=/run/certs/broker-api/server.key
BROKER_API_TLS_CERT_PATH=/run/certs/broker-api/server.crt
BROKER_API_TLS_CLIENT_CA_PATH=/run/certs/broker-api/ca.crt
BROKER_API_TLS_REQUIRE_CLIENT_CERT=true
BROKER_API_TLS_REJECT_UNAUTHORIZED_CLIENT_CERT=true
# Provide one of the two:
BROKER_API_STATE_PATH=/var/lib/broker-api/state.json
# BROKER_API_INITIAL_STATE_JSON={}
